% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RFplus.R
\name{RFplus}
\alias{RFplus}
\title{RFplus: Bias Correction of Satellite Products Using Random Forest and Quantile Regression Forests}
\usage{
RFplus(
  Covariates,
  BD_Insitu,
  Cords_Insitu,
  ntree = 2000,
  threshold = NULL,
  n_round = NULL,
  save_model = F,
  name_save = NULL,
  seed = 123
)
}
\arguments{
\item{Covariates}{A list of `terra::SpatRaster` objects representing predictive features, including:
- Satellite-derived data layers
- Digital Elevation Model (DEM)
- Additional environmental covariates as needed}

\item{BD_Insitu}{A `data.table` containing in-situ measurements with the following columns:
- `Date`: Measurement dates (Date format)
- Observed variable columns with numerical values}

\item{Cords_Insitu}{A `data.table` with station coordinates, including:
- `Cod`: Unique station ID (matching IDs in `BD_Insitu`)
- `X`: Longitude values
- `Y`: Latitude values}

\item{ntree}{An integer specifying the number of trees for all forest models (RF, residual RF, and QRF). Default: 2000.}

\item{threshold}{A numeric value defining the lower limit for predictions. Predictions below this threshold are set to 0. Default: `NULL` (retains all values, useful for temperature predictions).}

\item{n_round}{An integer indicating the number of decimal places for rounding final predictions. Default: `NULL` (no rounding applied).}

\item{save_model}{A logical value indicating whether to save the final model output as a NetCDF file. Default: `FALSE`.}

\item{name_save}{A character string specifying the base file name for saved outputs (without the `.nc` extension). Default: "Model_RFplus".}

\item{seed}{An integer for setting the random seed to ensure reproducibility. Default: 123.}
}
\value{
A `terra::SpatRaster` containing the bias-corrected predictions. Spatial properties match those of the input covariates.
}
\description{
RFplus applies a comprehensive bias correction approach that combines three modeling steps to enhance satellite-derived environmental data. This ensemble method includes:
1) Initial Random Forest predictions,
2) Residual corrections using a secondary Random Forest, and
3) Outlier preservation through Quantile Regression Forests (QRF).
The final predictions are calculated as a weighted average of all steps.
}
\details{
The RFplus methodology operates in three stages:
- **Base Prediction**: A Random Forest model generates predictions based on satellite data and environmental covariates.
- **Residual Correction**: A second Random Forest model corrects residual errors from the base predictions.
- **Outlier Adjustment**: A Quantile Regression Forest computes prediction quantiles (Q5, Q8, Q9) to preserve distribution tails.

Final predictions are calculated as:
\deqn{(Q5 + Q8 + Q9 + Residual-adjusted prediction) / 4}
This formulation balances overall accuracy while maintaining outliers.
}
\note{
This approach ensures outliers are preserved while reducing overall bias. The QRF component specifically enhances the preservation of distribution tails through its quantile-based estimates.
}
\author{
Jonnathan Augusto Landi Bermeo
}
